@model FastGooey.Models.ViewModels.ManageAccountViewModel

<form method="post"
      hx-post="/Workspaces/@ViewData["WorkspaceId"]/AccountManagement/Workspace/Save"
      hx-trigger="blur from:#FormModel_FirstName, keyup[key=='Enter'] changed delay:500ms from:#FormModel_FirstName, blur from:#FormModel_LastName, keyup[key=='Enter'] changed delay:500ms from:#FormModel_LastName"
      hx-target="#workspaceEditor">
    @Html.AntiForgeryToken()
    <div id="editor" class="mx-auto max-w-3xl mt-8">
        <div class="formGroup formGroupAddBackground mb-8">
            <div class="w-full border-b border-b-zinc-300 py-2 px-4">
                <p class="font-semibold text-sm">My Details</p>
            </div>
            <div class="py-2 px-4">
                <div class="mb-4">
                    <label asp-for="FormModel.FirstName"></label>
                    <input asp-for="FormModel.FirstName"
                           type="text"
                           class="w-full @(Model.FormModel.IsSaved ? "saved" : "")"/>
                    <span asp-validation-for="FormModel.FirstName" class="text-red-600 text-sm mt-1 block"></span>
                </div>
                <div class="mb-4">
                    <label asp-for="FormModel.LastName"></label>
                    <input asp-for="FormModel.LastName"
                           type="text"
                           class="w-full @(Model.FormModel.IsSaved ? "saved" : "")"/>
                    <span asp-validation-for="FormModel.LastName" class="text-red-600 text-sm mt-1 block"></span>
                </div>
                <div class="mb-4">
                    <p class="block text-sm font-medium text-gray-700">Email Address</p>
                    <p>@Model.User.Email</p>
                </div>
            </div>
        </div>
            
        <div class="formGroup formGroupAddBackground mb-8">
            <div class="w-full border-b border-b-zinc-300 py-2 px-4 mb-2">
                <p class="font-semibold text-sm">Authentication</p>
            </div>
            <div class="py-2 px-4">
                <div class="mb-6">
                    <p class="block text-sm font-medium text-gray-700">Passkeys</p>
                    <p class="text-sm text-gray-500">Use a passkey for quick, phishing-resistant sign-ins.</p>
                    <div class="mt-3 flex gap-2">
                        <input id="passkeyDisplayName"
                               type="text"
                               placeholder="e.g. MacBook Pro"
                               autocomplete="webauthn"
                               class="flex-1"/>
                        <button type="button"
                                class="bg-blueMid text-white font-semibold rounded px-4 py-2 text-sm"
                                data-passkey-register-url="@Url.Action("BeginPasskeyRegistration", "Auth")"
                                data-passkey-register-complete-url="@Url.Action("CompletePasskeyRegistration", "Auth")"
                                data-passkey-display-name-id="passkeyDisplayName">
                            Add passkey
                        </button>
                    </div>
                </div>

                <div class="space-y-2">
                    @if (Model.Passkeys.Count == 0)
                    {
                        <p class="text-sm text-gray-500">
                            No passkeys registered yet.
                        </p>
                    }
                    else
                    {
                        foreach (var passkey in Model.Passkeys)
                        {
                            <div class="flex items-center justify-between rounded border border-zinc-200 px-3 py-2">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">
                                        @(string.IsNullOrWhiteSpace(passkey.DisplayName) ? "Passkey" : passkey.DisplayName)
                                    </p>
                                    <p class="text-xs text-gray-500">
                                        Added @passkey.CreatedAt.InUtc().ToString("MMM d, yyyy", System.Globalization.CultureInfo.InvariantCulture)
                                    </p>
                                </div>
                                <button type="button"
                                        hx-delete="@Url.Action("DeletePasskey", "AccountManagement", new { workspaceId = ViewData["WorkspaceId"], passkeyId = passkey.Id })"
                                        hx-confirm="Are you sure you want to remove this passkey?"
                                        hx-target="#workspaceEditor"
                                        class="text-sm text-red-600">
                                    Remove
                                </button>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
                
        <div class="formGroup formGroupAddBackground mb-8">
            <div class="w-full border-b border-b-zinc-300 py-2 px-4 mb-2">
                <p class="font-semibold text-sm">Meta</p>
            </div>
            <div class="py-2 px-4">
                <div class="mb-4">
                    <p class="block text-sm font-medium text-gray-700">Account Created</p>
                    <p>@Model.User.CreatedAt.InUtc().ToString("MMMM d, yyyy hh:mm tt", System.Globalization.CultureInfo.InvariantCulture)</p>
                </div>
            </div>
        </div>
    </div>
</form>

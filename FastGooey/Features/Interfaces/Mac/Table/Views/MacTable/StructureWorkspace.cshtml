@using FastGooey.Features.Interfaces.Mac.Shared.Models.ViewModels.Mac
@model FastGooey.Features.Interfaces.Mac.Shared.Models.ViewModels.Mac.MacInterfaceTableStructureWorkspaceViewModel

<div
    hx-get="@Url.Action("TableStructureWorkspace", "MacTable", new { workspaceId = Model.WorkspaceId(), interfaceId = Model.InterfaceId() })"
    hx-trigger="refreshStructureWorkspace from:body">
    <div id="editor" class="mx-auto max-w-4xl mt-8">
        <div class="contentGroup formGroupAddBackground mb-8">
            <div class="w-full border-b border-b-zinc-300 py-2 px-4">
                <p class="font-semibold">Header Structure</p>
            </div>
            <form id="headerStructureForm">
                <div id="headerStructure" class="px-4">
                    @{ var headerCounter = 1; }
                    @foreach (var headerConfig in Model.Data.Header)
                    {
                        var viewModel = new TableItemOptionRowViewModel
                        {
                            OptionRowCounter = headerCounter,
                            SelectedAlias = headerConfig.FieldAlias,
                            Structure = Model.Data.Structure
                        };
                        
                        @await Html.PartialAsync("Partials/TableHeaderOptionRow", viewModel)
                        
                        headerCounter += 1;
                    }
                </div>
            </form>
            <div class="py-4 px-4">
                <button
                    hx-get="@Url.Action("TableHeaderOptionRow", "MacTable", new { workspaceId = Model.WorkspaceId(), interfaceId = Model.InterfaceId() })"
                    hx-target="#headerStructure"
                    hx-swap="beforeend"
                    type="button"
                    class="bg-blueMid text-white font-semibold rounded px-2 py-1 cursor-pointer text-sm">
                    Add Column
                </button>
                
                <button
                    hx-post="@Url.Action("SaveStructureWorkspace", "MacTable", new { workspaceId = Model.WorkspaceId(), interfaceId = Model.InterfaceId() })"
                    hx-target="#workspaceEditor"
                    hx-include="#headerStructureForm"
                    type="button"
                    class="bg-green-600 text-white font-semibold rounded px-2 py-1 cursor-pointer text-sm">
                    Save
                </button>
            </div>
        </div>
        
        <div class="contentGroup formGroupAddBackground mb-8">
            <div class="w-full border-b border-b-zinc-300 py-2 px-4">
                <p class="font-semibold">Table Structure</p>
            </div>
            <div class="px-4">
                <div class="border-b border-b-zinc-300 py-2 flex items-center align-middle gap-4 font-bold">
                    <div class="flex-1">
                        <button type="button" disabled="disabled">Field Name</button>
                    </div>
                    <p class="w-32">Field Alias</p>
                    <p class="w-32">Field Type</p>
                </div>
                @foreach (var fieldConfig in Model.Data.Structure)
                {
                    <div class="border-b border-b-zinc-300 py-2 flex items-center align-middle gap-4">
                        <div class="flex-1">
                            <button 
                                hx-get="@Url.Action("TableFieldEditorPanel", "MacTable", new { workspaceId = Model.WorkspaceId(), interfaceId = Model.InterfaceId(), fieldAlias = fieldConfig.FieldAlias })"
                                hx-target="#editorPanel"
                                onclick="toggleEditor()"
                                type="button" 
                                class="bg-zinc-200 hover:bg-zinc-300 text-shadow-zinc-700 font-semibold rounded px-2 py-1 cursor-pointer">
                                @fieldConfig.FieldName
                            </button>
                        </div>
                        <p class="w-32">@fieldConfig.FieldAlias</p>
                        <p class="w-32">@fieldConfig.FieldType</p>
                    </div>
                }
            </div>
            <div class="py-4 px-4">
                <button
                    hx-get="@Url.Action("TableFieldEditorPanel", "MacTable", new { workspaceId = Model.WorkspaceId(), interfaceId = Model.InterfaceId() })"
                    hx-target="#editorPanel"
                    type="button"
                    onclick="toggleEditor()"
                    class="bg-blueMid text-white font-semibold rounded px-2 py-1 cursor-pointer text-sm">
                    Add Table Field...
                </button>
            </div>
        </div>
    </div>
</div>
